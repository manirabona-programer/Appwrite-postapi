import{a as c}from"./services.3795b00f.js";import{n as g,A as u,t as d,r as h}from"./index.33ed05e9.js";import{u as a}from"./CollectionStore.2fd3b3fa.js";const _={data(){return{storage:u().storage(),database:u().database(),isLoading:!1,response:"",purposes:{create_new_item:"add_item",update_folder:"update_folder"}}},methods:{async updateCollection(e){d(()=>{this.isLoading=!0;let i=a().get,t=i.file,s={};if(e.section=="info.name"&&(t.info.name=e.name),e.section=="info.description"&&(t.info.description=e.description),t.hasOwnProperty("info")&&(s.info=t.info),t.hasOwnProperty("auth")&&(s.auth=t.auth),t.hasOwnProperty("event")&&(s.event=t.event),t.hasOwnProperty("item")&&(s.item=t.item),e.section=="item"){let n=this.traverseThroughJSON(t.item,e.id,this.purposes.update_folder,e);s.item=n}const r=new Blob([JSON.stringify(s)],{type:"application/json"}),l=new File([r],"patienceman_"+h(10)+".json",{type:r.type});this.storage.store(l).then(n=>{const f={storage_file_id:n.$id,collection_url:n.name};this.database.collection(c.collection_table),this.database.update(i.$id,f).then(o=>{this.storage.destroy(i.file_id).then(()=>{a().store({...o,file:s,file_id:n.$id}),this.$root.$emit("new_message",{responseType:"success",response:"File updated successfully",hasResponse:!0}),this.isLoading=!1})})})})},traverseThroughJSON(e,i,t,s){for(var r in e)typeof e[r]=="object"&&e[r]!==null?e[r]=this.traverseThroughJSON(e[r],i,t,s):r=="id"&&e[r]==i&&(t==this.purposes.create_new_item&&e.item.push({id:s.id,name:s.name,description:s.description,request:s.request,response:s.response}),t==this.purposes.update_folder&&(s.hasOwnProperty("name")&&(e.name=s.name),s.hasOwnProperty("description")&&(e.description=s.description),s.hasOwnProperty("request")&&(e.request=s.request)));return e},async saveNewFolderInCollection(e){d(()=>{this.isLoading=!0;let i=a().get,t=i.file,s={};s.info=t.info,s.auth=t.auth,s.event=t.event,s.item=t.item,s.item.push(e);const r=new Blob([JSON.stringify(s)],{type:"application/json"}),l=new File([r],"patienceman_"+h(10)+".json",{type:r.type});this.storage.store(l).then(n=>{const f={storage_file_id:n.$id,collection_url:n.name};this.database.collection(c.collection_table),this.database.update(i.$id,f).then(o=>{this.storage.destroy(i.file_id).then(()=>{a().store({...o,file:s,file_id:n.$id}),this.$root.$emit("new_message",{responseType:"success",response:"Folder created successfully",hasResponse:!0}),this.isLoading=!1})})})})},async saveNewRequestInFolder(e){d(()=>{this.isLoading=!0;let i=a().get,t=i.file,s=e.folderId,r={};r.info=t.info,r.auth=t.auth,r.event=t.event,r.item=t.item;let l=this.traverseThroughJSON(t.item,e.folderId,this.purposes.create_new_item,e);r.item=l;const n=new Blob([JSON.stringify(r)],{type:"application/json"}),f=new File([n],"patienceman_"+h(10)+".json",{type:n.type});this.storage.store(f).then(o=>{const p={storage_file_id:o.$id,collection_url:o.name};this.database.collection(c.collection_table),this.database.update(i.$id,p).then(m=>{this.storage.destroy(i.file_id).then(()=>{a().store({...m,file:r,file_id:o.$id}),this.$root.$emit("new_message",{responseType:"success",response:"Request created successfully",hasResponse:!0}),this.isLoading=!1,document.getElementById(s).click()})})})})}},mounted(){this.$root.$on("save_collection_changes",async e=>{e.hasOwnProperty("before")&&e.before instanceof Function&&e.before(),this.response=e.hasOwnProperty("alertMessage")?e.alertMessage:"Save changes",await this.updateCollection(e.data),e.hasOwnProperty("after")&&e.after instanceof Function&&!this.isLoading&&e.after()}),this.$root.$on("new_folder",async e=>{e.hasOwnProperty("before")&&e.before instanceof Function&&e.before(),this.response=e.hasOwnProperty("alertMessage")?e.alertMessage:"Save changes",await this.saveNewFolderInCollection(e.data),e.hasOwnProperty("after")&&e.after instanceof Function&&!this.isLoading&&e.after()}),this.$root.$on("new_request",async e=>{e.hasOwnProperty("before")&&e.before instanceof Function&&e.before(),this.response=e.hasOwnProperty("alertMessage")?e.alertMessage:"Save changes",await this.saveNewRequestInFolder(e.data),e.hasOwnProperty("after")&&e.after instanceof Function&&!this.isLoading&&e.after()})}};var w=function(){var i=this,t=i._self._c;return i.isLoading?t("transition",{attrs:{name:"alert"}},[t("div",{staticClass:"flex fixed z-30 bottom-2 right-5 items-center p-4 mb-4 max-w-md text-gray-500 bg-white rounded-xl shadow dark:text-gray-400 dark:bg-gray-800",staticStyle:{"font-size":"15px"},attrs:{id:"toast-success",role:"alert"}},[t("div",{staticClass:"inline-flex flex-shrink-0 justify-center items-center w-8 h-8"},[t("div",[t("span",{staticClass:"relative inset-0 inline-flex h-6 w-6 animate-spin items-center justify-center rounded-full border-2 border-gray-300 after:absolute after:h-8 after:w-8 after:rounded-full after:border-2 after:border-y-indigo-500 after:border-x-transparent"})])]),t("div",{staticClass:"ml-3 font-normal",staticStyle:{"font-size":"15px !important"}},[i._v(i._s(i.response))]),t("button",{staticClass:"ml-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex h-8 w-8 dark:text-gray-500 dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700",attrs:{type:"button","data-dismiss-target":"#toast-success","aria-label":"Close"},on:{click:function(s){return i.diableAlert()}}},[t("span",{staticClass:"sr-only"},[i._v("Close")]),t("svg",{staticClass:"w-5 h-5",attrs:{"aria-hidden":"true",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"}})])])])]):i._e()},b=[],v=g(_,w,b,!1,null,null,null,null);const x=v.exports;export{x as default};
